diff -ruN xinit-1.0.4.orig/configure.ac xinit-1.0.4/configure.ac
--- xinit-1.0.4.orig/configure.ac	2007-09-08 01:03:45.000000000 -0500
+++ xinit-1.0.4/configure.ac	2007-09-08 01:06:15.000000000 -0500
@@ -93,7 +93,7 @@
 	[XINIT="$DEFAULT_XINIT"])
 
 # Checks for pkg-config packages
-PKG_CHECK_MODULES(XINIT, x11)
+PKG_CHECK_MODULES(XINIT, x11 ck-connector)
 
 case $host_os in
     *bsd*)
diff -ruN xinit-1.0.4.orig/startx.cpp xinit-1.0.4/startx.cpp
--- xinit-1.0.4.orig/startx.cpp	2007-09-08 01:03:45.000000000 -0500
+++ xinit-1.0.4/startx.cpp	2007-09-08 01:06:15.000000000 -0500
@@ -81,6 +81,12 @@
 #endif
 fi
 
+if [ x"$display" != x ]; then
+    export DISPLAY=$display
+else
+    export DISPLAY=:0
+fi
+
 #if defined(__SCO__) || defined(__UNIXWARE__)
 
 XCOMM SCO -t option: do not start an X server
diff -ruN xinit-1.0.4.orig/xinit.c xinit-1.0.4/xinit.c
--- xinit-1.0.4.orig/xinit.c	2007-09-08 01:03:45.000000000 -0500
+++ xinit-1.0.4/xinit.c	2007-09-08 01:10:54.000000000 -0500
@@ -39,6 +39,13 @@
 #include <ctype.h>
 #include <stdint.h>
 
+#define USE_CONKIT
+#ifdef USE_CONKIT
+#include <ck-connector.h>
+#include <X11/Xatom.h>
+static CkConnector *ckc = NULL;
+#endif /* USE_CONKIT */
+
 #ifdef X_POSIX_C_SOURCE
 #define _POSIX_C_SOURCE X_POSIX_C_SOURCE
 #include <signal.h>
@@ -522,6 +529,39 @@
 	return( serverpid != pidfound );
 }
 
+
+#ifdef USE_CONKIT
+static void
+register_new_session_with_console_kit (void)
+{
+	static char conkitbuf[256];
+	DBusError   error;
+
+	ckc = ck_connector_new ();
+	if (ckc == NULL) {
+		Error ("Cannot register with ConsoleKit: OOM creating CkConnector\n");
+		goto out;
+	}
+
+	dbus_error_init (&error);
+	if (!ck_connector_open_session (ckc, &error)) {
+		Error ("Cannot register with ConsoleKit: %s: %s\n", error.name, error.message);
+		goto out;
+	}
+
+	/* If we managed to register with ConsoleKit, put the
+	 * environment variable XDG_SESSION_COOKIE=cookie as second
+	 * element in newenviron. See set_environment() where we
+	 * earlier have made sure there is room...
+	 */
+	conkitbuf[sizeof (conkitbuf) - 1] = '\0';
+	snprintf (conkitbuf, sizeof (conkitbuf) - 1, "XDG_SESSION_COOKIE=%s", ck_connector_get_cookie (ckc));
+	newenviron[1] = conkitbuf;
+out:
+	;
+}
+#endif /* USE_CONKIT */
+
 static int
 startServer(char *server[])
 {
@@ -632,6 +672,12 @@
 		break;
 	}
 
+#ifdef USE_CONKIT
+	if (serverpid != -1 ) {
+		register_new_session_with_console_kit ();
+	}
+#endif /* USE_CONKIT */
+
 	return(serverpid);
 }
 
@@ -776,6 +822,13 @@
 				clientpid);
 	}
 
+#ifdef USE_CONKIT
+	if (ckc != NULL) {
+		ck_connector_unref (ckc);
+		ckc = NULL;
+	}
+#endif
+
 	if (serverpid < 0)
 		return;
 	errno = 0;
@@ -812,6 +865,13 @@
  * make a new copy of environment that has room for DISPLAY
  */
 
+
+#ifdef USE_CONKIT
+#define NUM_EXTRA_ENV_VARS 3
+#else
+#define NUM_EXTRA_ENV_VARS 2
+#endif
+
 static void 
 set_environment(void)
 {
@@ -837,10 +897,18 @@
     newPtr = newenviron;
     *newPtr++ = displaybuf;
 
+#ifdef USE_CONKIT
+    *newPtr++ = "XDG_SESSION_COOKIE=";
+#endif
+
     /* copy pointers to other variables */
     for (oldPtr = environ; *oldPtr; oldPtr++) {
+   #ifdef USE_CONKIT
+   if (strncmp (*oldPtr, "DISPLAY=", 8) !=0 && strncmp (*oldPtr, "XDG_SESSION_COOKIE=", 19) !=0) {
+   #else
 	if (strncmp (*oldPtr, "DISPLAY=", 8) != 0
 	 && strncmp (*oldPtr, "WINDOWPATH=", 11) != 0) {
+   #endif
 	    *newPtr++ = *oldPtr;
 	}
     }
diff -ruN xinit-1.0.4.orig/xinit.c.rej xinit-1.0.4/xinit.c.rej
--- xinit-1.0.4.orig/xinit.c.rej	1969-12-31 18:00:00.000000000 -0600
+++ xinit-1.0.4/xinit.c.rej	2007-09-08 01:06:15.000000000 -0500
@@ -0,0 +1,54 @@
+***************
+*** 823,833 ****
+      for (oldPtr = environ; *oldPtr; oldPtr++) ;
+  
+      nenvvars = (oldPtr - environ);
+-     newenviron = (char **) malloc ((nenvvars + 2) * sizeof(char **));
+      if (!newenviron) {
+  	fprintf (stderr,
+  		 "%s:  unable to allocate %d pointers for environment\n",
+- 		 program, nenvvars + 2);
+  	exit (1);
+      }
+  
+--- 884,894 ----
+      for (oldPtr = environ; *oldPtr; oldPtr++) ;
+  
+      nenvvars = (oldPtr - environ);
++     newenviron = (char **) malloc ((nenvvars + NUM_EXTRA_ENV_VARS) * sizeof(char **));
+      if (!newenviron) {
+  	fprintf (stderr,
+  		 "%s:  unable to allocate %d pointers for environment\n",
++ 		 program, nenvvars + NUM_EXTRA_ENV_VARS);
+  	exit (1);
+      }
+  
+***************
+*** 837,845 ****
+      newPtr = newenviron;
+      *newPtr++ = displaybuf;
+  
+      /* copy pointers to other variables */
+      for (oldPtr = environ; *oldPtr; oldPtr++) {
+  	if (strncmp (*oldPtr, "DISPLAY=", 8) != 0) {
+  	    *newPtr++ = *oldPtr;
+  	}
+      }
+--- 898,914 ----
+      newPtr = newenviron;
+      *newPtr++ = displaybuf;
+  
++ #ifdef USE_CONKIT
++     *newPtr++ = "XDG_SESSION_COOKIE=";
++ #endif
++ 
+      /* copy pointers to other variables */
+      for (oldPtr = environ; *oldPtr; oldPtr++) {
++ #ifdef USE_CONKIT
++ 	if (strncmp (*oldPtr, "DISPLAY=", 8) != 0 && strncmp (*oldPtr, "XDG_SESSION_COOKIE=", 19) != 0) {
++ #else
+  	if (strncmp (*oldPtr, "DISPLAY=", 8) != 0) {
++ #endif
+  	    *newPtr++ = *oldPtr;
+  	}
+      }
